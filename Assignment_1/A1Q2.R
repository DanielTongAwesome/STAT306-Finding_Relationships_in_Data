# clear screen and console
cat("\014")  
rm(list=ls())

# inital data
x=c(170.2, 170.4, 180, 169, 180.1, 177, 170.6, 187.1, 184.5, 174.5, 169.1, 171.6, 183.1, 163.9, 169.4, 173.9, 171.6, 166.6, 178.4, 173.5, 172.1, 171.9, 161.8, 173.1, 166.6, 172, 183.6, 173, 179.9, 159, 173, 175.8, 162.5, 174.8, 182, 171.2, 183.9, 189.3, 174.9, 171.1, 172.6, 171.6, 169.7, 174.1, 169, 173.9, 166, 174.7, 168.9, 169.4, 170, 169.5, 171.3, 155.3, 177.6, 159.5, 164.9, 173.3, 171.1, 173.2, 170, 179.6, 179.1, 172.3, 184.2, 168.4, 171.7, 173.5, 173.5, 169.1, 184.9, 186, 174.8, 172.8, 177.3, 182.7, 178.6, 168.1, 170.8, 159.1, 170.2, 183.2, 171, 171, 163.2, 164.4, 170.2, 155, 180.1, 170.6, 168.7, 193.4, 174.9, 174.5, 172.9, 177.3, 160.2, 170.5, 159.2, 168.6, 173.1, 171.9, 182.4, 187.9, 173.5, 175.1, 175.5, 174.7, 164.6, 176.6, 176.7, 185, 175.4, 172.2, 172.9, 182.1, 174.6, 182.3, 158.5, 166.2, 169.6, 160.6, 172.8, 175, 172.6, 168.8, 169.4, 174, 166.4, 167.7, 162.9, 173.8, 179.7, 172.8, 166.2, 167.1, 168.1, 168.2, 170.8, 176.4, 172.5, 178.7, 175.5, 164.6, 175, 160.5, 163.5, 164.1, 175.1, 178.5, 164.1, 171.6, 170.2, 168.5, 170, 168.6, 183.4, 165.2, 183.5, 172.7, 173.3, 182, 176.4, 181.5, 181.2, 170.8, 167.6, 167.6, 179, 161.3, 171.7, 185.1, 167.7, 160.9, 183, 170.6, 168.9, 172.3, 169.8, 186.8)
y=c(181.8, 151.5, 178.8, 171.4, 173.1, 176.1, 175.9, 169.9, 179.5, 184.4, 164.1, 172.9, 186.7, 164.7, 174, 166.2, 169.2, 172.9, 187.1, 180.5, 165.3, 169.5, 168.7, 173.6, 174.6, 175.2, 188.8, 175.8, 179.4, 172.1, 169.6, 181.4, 171.7, 191, 173.5, 171.9, 178.3, 192.5, 174.3, 180, 169.5, 168.9, 171.7, 174.3, 183.9, 178.8, 164.4, 172.7, 176.8, 165.4, 178.5, 178.7, 165.8, 164.7, 181, 178.4, 169.2, 173.6, 180.2, 172.6, 177.7, 174.4, 169.1, 177.2, 181.1, 181.9, 176, 170, 169.3, 177.4, 182.9, 185.9, 183.4, 176.1, 177.9, 185.4, 182.5, 170.6, 165.5, 158.2, 176.7, 175.7, 178.9, 173.3, 163.6, 167.8, 185.2, 162.8, 169.7, 178.5, 172.4, 190.3, 178.8, 177.1, 176.1, 178.2, 164.9, 176.8, 174.5, 173.1, 182.6, 169.9, 176.8, 184.1, 175.6, 178.4, 173.5, 174.7, 163.5, 174.9, 187.1, 177.5, 166.7, 171.2, 170.4, 190.5, 168, 184.8, 179.8, 174.1, 165.5, 164.3, 172.6, 180.8, 179.6, 179.9, 169, 182.5, 170, 171.9, 161.5, 173.8, 186.2, 172.4, 163.6, 180, 175.8, 183.8, 173.2, 181.9, 167.1, 183.5, 165.2, 172.8, 174.3, 166.9, 163.1, 171.8, 176.4, 193, 172.7, 177.7, 175.2, 169.2, 182.3, 163.3, 178.7, 162, 166.8, 156.8, 169.3, 175.6, 179.3, 172.3, 169.3, 168.2, 170, 169.8, 183.6, 163.6, 168.3, 188.9, 175, 164.1, 182.6, 182.4, 177.5, 177.5, 169, 183.3)
n = length(x)

# get x,y summary
x_summary<-summary(x)
y_summary<-summary(y)
# print summary
print(x_summary)
print(y_summary)
#coorelation coefficient
sxy = cov(x,y)
sx = sd(x)
sy = sd(y)
rxy = sxy/(sx*sy)
message("x_hat: \t", mean(x))
message("y_hat: \t", mean(y))
message("x_sd: \t", sx)
message("y_sd: \t", sy)
message("rxy: \t", rxy)

# linear model
x_choosen <- 181
Model <- lm(y~x)
b0 <- Model$coefficients[1]
b1 <- Model$coefficients[2]
# c1 - subpopulation mean
sub_pop_mean = b0 + b1*x_choosen
y_predicted  = b0 + b1*x
message("subpopulation mean: \t", sub_pop_mean)
# c2 - standard error for this estimation
sigma_hat = sqrt(sum((y - y_predicted)^2)/(n-2) )
sd_predicted = sigma_hat * sqrt(1/n + ((x_choosen-mean(x))^2/((n-1)*(sx)^2)))
message("standard error: \t", sd_predicted)
# c3 - t-critical for 95% CI
t_crit <- (qt(c(.025, .975), df=n-2))[2] # take one positive value
CI_interval <- c(sub_pop_mean-t_crit*sd_predicted, sub_pop_mean+t_crit*sd_predicted)
message("95% CI: \t", CI_interval[1],' ', CI_interval[2])

# c4 - not using statistic method, but using the data
df <- data.frame(x,y)
x_range = 2.5
x_subset <- subset(df, df$x>=x_choosen-x_range & df$x<=x_choosen+x_range)
n_partd = length(x_subset$x)
CI_interval_test <- c(mean(x_subset$y)-2*sd(x_subset$y)/sqrt(n_partd), mean(x_subset$y)+2*sd(x_subset$y)/sqrt(n_partd))
message("95% CI: \t", CI_interval_test[1],' ', CI_interval_test[2])




